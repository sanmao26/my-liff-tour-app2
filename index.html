<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Debugger</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f0f0; text-align: center; }
        .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        button { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-green { background-color: #06c755; color: white; }
        .btn-red { background-color: #ff4d4f; color: white; }
        .status { margin-top: 10px; font-size: 14px; color: #666; }
        textarea { width: 90%; height: 100px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; }
    </style>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>

    <div class="box">
        <h3>üîß ‡∏ï‡∏±‡∏ß‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
        <p class="status" id="debugLog">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
        
        <label>LIFF ID:</label>
        <input type="text" id="liffIdInput" placeholder="200xxxxxxx-xxxxxxx">
        
        <button onclick="startConnect()" class="btn-green">1. ‡∏Å‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (Connect)</button>
        <button onclick="resetSystem()" class="btn-red">2. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Reset)</button>
    </div>

    <div class="box" id="sendSection" style="display:none;">
        <h3>‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
        <textarea id="jsonInput" placeholder="‡∏ß‡∏≤‡∏á JSON ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>
        <button onclick="loadSample()" style="background:#eee; color:#333;">‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
        <br><br>
        <button onclick="sendFlex()" class="btn-green">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Send)</button>
    </div>

    <script>
        // 1. ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å
        const MY_LIFF_ID = "2006670623-79XEraMq"; 

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.onload = function() {
            log("‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (v1.0)");
            
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            let savedId = localStorage.getItem('debug_liff_id');
            if(!savedId) savedId = MY_LIFF_ID;
            document.getElementById('liffIdInput').value = savedId;
        }

        async function startConnect() {
            const liffId = document.getElementById('liffIdInput').value.trim();
            if(!liffId) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà LIFF ID");

            log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö: " + liffId + " ...");
            localStorage.setItem('debug_liff_id', liffId);

            try {
                // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô Init
                await liff.init({ liffId: liffId });
                log("LIFF Init ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

                // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô Login
                if (!liff.isLoggedIn()) {
                    log("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á Login");
                    liff.login();
                    return;
                }

                // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
                log("Login ‡πÅ‡∏•‡πâ‡∏ß! ‡∏ä‡∏∑‡πà‡∏≠: " + (await liff.getProfile()).displayName);
                document.getElementById('sendSection').style.display = 'block';

            } catch (err) {
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏á
                alert("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!\n\nError: " + err.message + "\n\n(‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á '‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤' ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà)");
                log("Error: " + err.message);
            }
        }

        function resetSystem() {
            if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏´‡∏°‡πà?")) {
                localStorage.clear();
                window.location.reload();
            }
        }

        async function sendFlex() {
            const jsonStr = document.getElementById('jsonInput').value;
            if(!jsonStr) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ JSON");

            try {
                let msg = JSON.parse(jsonStr);
                // Auto-fix
                if(msg.type === 'bubble') msg = { type: 'flex', altText: 'Flex', contents: msg };

                if (!liff.isApiAvailable('shareTargetPicker')) {
                    alert("‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
                    return;
                }

                const res = await liff.shareTargetPicker([msg]);
                if(res) {
                    alert("‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                    liff.closeWindow();
                }
            } catch(e) {
                alert("JSON ‡∏ú‡∏¥‡∏î: " + e.message);
            }
        }

        function loadSample() {
            const sample = { type: "flex", altText: "Test", contents: { type: "bubble", body: { type: "box", layout: "vertical", contents: [{ type: "text", text: "Work!" }] } } };
            document.getElementById('jsonInput').value = JSON.stringify(sample);
        }

        function log(msg) {
            document.getElementById('debugLog').innerText = msg;
            console.log(msg);
        }
    </script>
</body>
</html>
